
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Apple School Manager å…¨æ ¡å¸³è™Ÿå·¥å…·</title>
  <style>
    body { font-family: 'Helvetica Neue', sans-serif; margin: 40px; background: #f4f7f9; color: #333; }
    h1 { color: #2c3e50; }
    .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
    label, input, button { display: block; margin: 10px 0; }
    .note { font-size: 0.9em; color: #555; }
    .download-link { margin: 10px 0; }
  </style>
</head>
<body>
  
  <h1>Apple School Manager å…¨æ ¡å¸³è™Ÿè½‰æ›å·¥å…·</h1>

  <div class="section">
    <h2>ğŸ“¥ ä¸Šå‚³è³‡æ–™</h2>
    <label>å­¸æ ¡ä»£ç¢¼ï¼ˆæ•™è‚²éƒ¨ä»£ç¢¼ï¼‰</label>
    <input type="text" id="schoolCode" placeholder="å¦‚ï¼š064756">
    
    <label>å­¸æ ¡åç¨±</label>
    <input type="text" id="schoolName" placeholder="å¦‚ï¼šå°ä¸­å¸‚ç«‹æ–°åœ‹å°">

    <label>ä¸Šå‚³å­¸ç”Ÿ CSV</label>
    <input type="file" id="studentCSV" accept=".csv">

    <label>ä¸Šå‚³æ•™å¸« CSV</label>
    <input type="file" id="teacherCSV" accept=".csv">
  </div>

  <div class="section">
    <h2>âœ… è³‡æ–™ä¸Šå‚³éœ€æ±‚</h2>
    <h3>ğŸ“˜ å­¸ç”Ÿ CSV</h3>
    <ul>
      <li>å­¸è™Ÿã€å§“åã€Apple IDã€å¯†ç¢¼ã€ç­ç´šä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š301-113ï¼‰</li>
    </ul>
    <h3>ğŸ“˜ æ•™å¸« CSV</h3>
    <ul>
      <li>Person IDã€å§“åã€Apple IDã€è§’è‰²ï¼ˆå°å¸«ã€ç§‘ä»»ã€è¡Œæ”¿ï¼‰</li>
      <li>æˆèª²ç­ç´šä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š301-113,302-114ï¼‰</li>
    </ul>
    <div class="download-link">
      ğŸ”½ <a href="ç”Ÿæˆçš„å­¸ç”Ÿè³‡æ–™ç¯„æœ¬_v2.csv" download>ä¸‹è¼‰å­¸ç”Ÿ CSV ç¯„æœ¬</a>
    </div>
    <div class="download-link">
      ğŸ”½ <a href="ç”Ÿæˆçš„æ•™å¸«è³‡æ–™ç¯„æœ¬_v2.csv" download>ä¸‹è¼‰æ•™å¸« CSV ç¯„æœ¬</a>
    </div>
  </div>

  <div class="section">
    <h2>âš™ï¸ è™•ç†èˆ‡åŒ¯å‡º</h2>
    <button onclick="generateAll()">ğŸ”„ ç”¢å‡º Apple School Manager æª”æ¡ˆ</button>
    <p class="note">è™•ç†å®Œæˆå¾Œï¼Œå°‡è‡ªå‹•ä¸‹è¼‰åŒ…å«å…­å€‹æª”æ¡ˆçš„ ZIPã€‚</p>
  </div>

  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    let students = [], teachers = [];

    function generateAll() {
      const schoolCode = document.getElementById('schoolCode').value.trim();
      const schoolName = document.getElementById('schoolName').value.trim();
      if (!schoolCode || !schoolName || students.length === 0 || teachers.length === 0) {
        alert("è«‹ç¢ºä¿å­¸æ ¡ä»£ç¢¼ã€åç¨±èˆ‡è³‡æ–™éƒ½æœ‰ä¸Šå‚³ï¼");
        return;
      }

      const classesSet = new Set();
      const courseRows = [];
      const classRows = [];
      const studentRows = [];
      const teacherRows = [];
      const rosterRows = [];

      const classCodeToId = {};
      let classIdCounter = 1;

      students.forEach(row => {
        const [id, name, email, pwd, classCode] = row;
        studentRows.push({
          "Person ID": id,
          "Last Name": name,
          "Managed Apple ID": email,
          "Password": pwd,
          "Grade": "",
          "Location ID": schoolCode
        });
        classesSet.add(classCode);
      });

      teachers.forEach(row => {
        const [pid, name, email, role, classCodes] = row;
        teacherRows.push({
          "Person ID": pid,
          "Last Name": name,
          "Managed Apple ID": email,
          "Role": role,
          "Location ID": schoolCode
        });
        classCodes.split(',').forEach(cls => {
          classesSet.add(cls.trim());
        });
      });

      const locationRows = [{
        "Location ID": schoolCode,
        "Location Name": schoolName
      }];

      classesSet.forEach(classCode => {
        const cid = 'C' + (classIdCounter++).toString().padStart(3, '0');
        classCodeToId[classCode] = cid;

        classRows.push({
          "Class Code": classCode,
          "Class Name": classCode,
          "Location ID": schoolCode
        });

        courseRows.push({
          "Course Code": cid,
          "Course Name": `èª²ç¨‹-${classCode}`,
          "Location ID": schoolCode
        });
      });

      students.forEach(row => {
        const [id,, , , classCode] = row;
        rosterRows.push({
          "Course Code": classCodeToId[classCode],
          "Person ID": id
        });
      });

      teachers.forEach(row => {
        const [pid,,, , classCodes] = row;
        classCodes.split(',').forEach(cls => {
          const c = cls.trim();
          if (classCodeToId[c]) {
            rosterRows.push({
              "Course Code": classCodeToId[c],
              "Person ID": pid
            });
          }
        });
      });

      const zip = new JSZip();
      const files = {
        "Students.csv": studentRows,
        "Staff.csv": teacherRows,
        "Classes.csv": classRows,
        "Courses.csv": courseRows,
        "Rosters.csv": rosterRows,
        "Locations.csv": locationRows
      };

      for (const [fileName, data] of Object.entries(files)) {
        const csv = Papa.unparse(data);
        zip.file(fileName, csv);
      }

      zip.generateAsync({type:"blob"}).then(function(content) {
        saveAs(content, "ASM_å¸³è™Ÿå…­å¤§æª”æ¡ˆ.zip");
      });
    }

    document.getElementById('studentCSV').addEventListener('change', (e) => {
      Papa.parse(e.target.files[0], {
        complete: results => {
          students = results.data.slice(1).filter(row => row.length >= 5);
        }
      });
    });

    document.getElementById('teacherCSV').addEventListener('change', (e) => {
      Papa.parse(e.target.files[0], {
        complete: results => {
          teachers = results.data.slice(1).filter(row => row.length >= 5);
        }
      });
    });
  </script>
</body>
</html>
